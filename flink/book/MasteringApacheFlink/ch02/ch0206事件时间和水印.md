# 事件时间和水印 
Event time and watermarks

## 事件时间 Event time
事件时间是生产设备中每个独立的事件发生的时间. 这时间通常在它们进入Flink之前被嵌入记录并且 事件时间戳 会从记录中抽取. 一小时的事件时间窗口将包含在这小时内所有带有时间戳的记录, 而不会去管记录到达的时间, 和记录是以什么顺序到达的.

事件时间即使是在无序事件, 延迟事件, 或者从备份或持久性日志中获得的数据中也能得出正确的结果. 在事件时间中, 时间的进度取决于数据, 而不是挂钟上的时间. 事件时间程序必须指定如何生成 事件时间 Watermarks, 也就是指示事件时间进度的机制. 下面是该机制的描述.

由于对延迟事件和无序事件产生等待时间的本质, 事件时间的处理通常会招致一定的延迟. 正因如此, 事件时间程序都常常结合着 处理时间 的操作.

## 处理时间 Procession time
处理时间是指正在执行相关进程的机器的系统时间.。
当一个流式程序在处理时间运行时, 所有基于时间的操作 (比如时间窗口) 将会使用运行相关算子的机器的系统时间. 打个比方, 一小时运行的时间窗口将会包含在系统时间指示的整小时内到达某一特定算子的所有记录.

处理时间是最普通的时间概念并且它不需要流和机器之间的协调. 它提供了最好的性能和最少的延迟. 然而, 在分布式环境和异步环境中的处理时间并不提供确定性, 因为 它容易受记录到达系统的速度(比如说从消息队列中来的), 和系统中在不同算子之间流动的记录的速度的影响.


## 摄取时间 Ingestion time
摄取时间是事件进入Flink的时间. 在源算子中每个记录将源的当前时间作为时间戳, 并且基于时间的操作 (比如时间窗口) 参考的就是这个时间戳.

摄取时间 从概念上讲介于 事件时间 和 处理时间之间. 对比 处理时间的话, 它的代价会稍微大一点, 但是会给出更多可预测的结果. 因为 摄取时间 采用稳定的时间戳 (在源处分配过一次), 所以记录上不同的窗口操作将引用相同的时间戳, 而在 处理时间 中每个窗口算子会将记录分配给一个不同的窗口 (基于本地系统时间和任何传输延迟).

比起 事件时间, 摄取时间 程序不能处理任何无序事件或延迟数据, 但程序无需去指定如何生成 watermarks.

在内部, 摄取时间 更像是被当成 事件时间, 只不过是多了时间戳自动分配和watermark 自动生成而已.